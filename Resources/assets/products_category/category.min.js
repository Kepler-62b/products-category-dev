/*
 *  Copyright 2023.  Baks.dev <admin@baks.dev>
 *  
 *  Permission is hereby granted, free of charge, to any person obtaining a copy
 *  of this software and associated documentation files (the "Software"), to deal
 *  in the Software without restriction, including without limitation the rights
 *  to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 *  copies of the Software, and to permit persons to whom the Software is furnished
 *  to do so, subject to the following conditions:
 *  
 *  The above copyright notice and this permission notice shall be included in all
 *  copies or substantial portions of the Software.
 *  
 *  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 *  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 *  FITNESS FOR A PARTICULAR PURPOSE AND NON INFRINGEMENT. IN NO EVENT SHALL THE
 *  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 *  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 *  OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 *  THE SOFTWARE.
 */

let $addButtonSection=document.getElementById("section_addCollection");let $blockCollection=document.getElementById("section_collection");if($blockCollection){deleteSection($blockCollection);deleteField($blockCollection);let $addButtonField=document.querySelectorAll('[id^="createSectionField"]');$addButtonField.forEach(function(item){createSectionField(item.dataset.section)});$addButtonSection.addEventListener("click",function(){let newForm=this.dataset.prototype;let index=this.dataset.index*1;newForm=newForm.replace(/__category_section__/g,index);let div=document.createElement("div");div.id="item-collection-section-"+index;div.classList.add("card");div.classList.add("p-4");div.classList.add("mb-3");div.classList.add("border-light");div.classList.add("item-collection-section");div.innerHTML=newForm;$blockCollection.append(div);div.scrollIntoView({block:"center",inline:"center",behavior:"smooth"});createSectionField(index);deleteSection(div);deleteField(div);this.dataset.index=(index+1).toString()})}function deleteSection($block){let $delItem=$block.querySelectorAll(".del-item-section");$delItem.forEach(function(item){item.addEventListener("click",function(){let $counter=$block.getElementsByClassName("item-collection-section").length;if($counter>1){item.closest(".item-collection-section").remove()}else{alert("Минимально должна быть добавлена одна секция")}})})}function deleteField($block){$delItem=$block.querySelectorAll(".del-item-field");$delItem.forEach(function(item){item.addEventListener("click",function(){let $fieldCollection=document.getElementById("field-collection-"+this.dataset.section);let $counter=$fieldCollection.querySelectorAll(".item-collection-field").length;if($counter>1){item.closest(".item-collection-field").remove()}else{alert("Минимально должна быть добавлена одна секция")}})})}function createSectionField(section){let $btnAddFields=document.getElementById("createSectionField"+section);$btnAddFields.addEventListener("click",function(){let section_id=$btnAddFields.dataset.section;let newForm=$btnAddFields.dataset.prototype;let index=$btnAddFields.dataset.index;newForm=newForm.replace(/__category_section__/g,section_id);newForm=newForm.replace(/__section_field__/g,index);newForm=newForm.replace(/__FIELD_SORT__/g,index*100+100);let div=document.createElement("div");div.id="item-collection-field-"+index;div.classList.add("item-collection-field");div.classList.add("pb-3");div.innerHTML=newForm;document.getElementById("field-collection-"+section_id).append(div);div.scrollIntoView({block:"center",inline:"center",behavior:"smooth"});deleteField(div);$btnAddFields.dataset.index=(index*1+1).toString()})}document.querySelectorAll(".is-reference").forEach(function(isReference){chanfeReferenc(isReference);isReference.addEventListener("change",function(){chanfeReferenc(this)})});let $name=document.querySelector("input[data-lang='product_category_form_translate_0_"+$lang+"']");if($name){setTimeout(function initBootstrap(){if(typeof catUrl.debounce==="function"){$name.addEventListener("input",catUrl.debounce(500));return}setTimeout(initBootstrap,100)},100);function catUrl(){document.getElementById("product_category_form_info_url").value=translitRuEn(this.value).toLowerCase()}}$offerSettings=document.getElementById("offer-settings");$checkboxOfferSettings=document.getElementById("product_category_form_offer_offer");$nameOfferSettings=document.querySelectorAll("input[id^='product_category_form_offer_translate']");$variationSettings=document.getElementById("variation-settings");$checkboxVariationSettings=document.getElementById("product_category_form_offer_variation_variation");$nameVariationSettings=document.querySelectorAll("input[id^='product_category_form_offer_variation_translate']");$modificationSettings=document.getElementById("modification-settings");$checkboxModificationSettings=document.getElementById("product_category_form_offer_variation_modification_modification");$nameModificationSettings=document.querySelectorAll("input[id^='product_category_form_offer_variation_modification_translate']");$checkboxOfferSettings.addEventListener("change",function(){if(this.checked==false){$offerSettings.classList.add("d-none");$checkboxVariationSettings.checked=false;$checkboxVariationSettings.disabled=true;$checkboxModificationSettings.checked=false;$checkboxModificationSettings.disabled=true;$variationSettings.classList.add("d-none");$modificationSettings.classList.add("d-none");Array.from($nameOfferSettings).forEach(e=>e.removeAttribute("required"));Array.from($nameVariationSettings).forEach(e=>e.removeAttribute("required"));Array.from($nameModificationSettings).forEach(e=>e.removeAttribute("required"))}else{Array.from($nameOfferSettings).forEach(e=>{if(e.name.match("postfix")===null){e.setAttribute("required",true)}});$offerSettings.classList.remove("d-none");$checkboxVariationSettings.disabled=false;$checkboxModificationSettings.disabled=false}});$checkboxVariationSettings.addEventListener("change",function(){if(this.checked==false){$variationSettings.classList.add("d-none");Array.from($nameVariationSettings).forEach(e=>e.removeAttribute("required"))}else{$variationSettings.classList.remove("d-none");Array.from($nameVariationSettings).forEach(e=>{if(e.name.match("postfix")===null){e.setAttribute("required",true)}})}});$checkboxModificationSettings.addEventListener("change",function(){if(this.checked==false){$modificationSettings.classList.add("d-none");Array.from($nameModificationSettings).forEach(e=>e.removeAttribute("required"))}else{$modificationSettings.classList.remove("d-none");Array.from($nameModificationSettings).forEach(e=>{if(e.name.match("postfix")===null){e.setAttribute("required",true)}})}});if($checkboxOfferSettings.checked==false){$offerSettings.classList.add("d-none");$checkboxVariationSettings.checked=false;$checkboxVariationSettings.disabled=true;$checkboxModificationSettings.checked=false;$checkboxModificationSettings.disabled=true;Array.from($nameOfferSettings).forEach(e=>e.removeAttribute("required"));Array.from($nameVariationSettings).forEach(e=>e.removeAttribute("required"));$variationSettings.classList.add("d-none");Array.from($nameModificationSettings).forEach(e=>e.removeAttribute("required"));$modificationSettings.classList.add("d-none")}else{$offerSettings.classList.remove("d-none");$checkboxVariationSettings.disabled=false;$checkboxModificationSettings.disabled=false;Array.from($nameOfferSettings).forEach(e=>{if(e.name.match("postfix")===null){e.setAttribute("required",true)}})}if($checkboxVariationSettings.checked==false){Array.from($nameVariationSettings).forEach(e=>e.removeAttribute("required"));$variationSettings.classList.add("d-none")}else{Array.from($nameVariationSettings).forEach(e=>{if(e.name.match("postfix")===null){e.setAttribute("required",true)}});$variationSettings.classList.remove("d-none")}if($checkboxModificationSettings.checked==false){Array.from($nameModificationSettings).forEach(e=>e.removeAttribute("required"));$modificationSettings.classList.add("d-none")}else{Array.from($nameModificationSettings).forEach(e=>{if(e.name.match("postfix")===null){e.setAttribute("required",true)}});$modificationSettings.classList.remove("d-none")}function chanfeReferenc($this){let ref=document.getElementById($this.dataset.reference);if($this.checked===true){ref.classList.remove("d-none")}else{ref.classList.add("d-none");ref.selectedIndex=0}}document.querySelectorAll(".change-postfix").forEach(function(postfix){postfix.addEventListener("change",function(){document.querySelectorAll("."+this.id).forEach(function(element){if(postfix.checked==true){element.classList.remove("d-none");element.querySelector("input").setAttribute("required",true)}else{element.classList.add("d-none");let inpt=element.querySelector("input");inpt.removeAttribute("required");inpt.removeAttribute("value")}})})});